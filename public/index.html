<!DOCTYPE html>
<html>

<head>
    <!-- Page's Title -->
    <title>Chat-Room 1.0</title>

    <!-- Socket.IO client script -->
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>

<body>
    <!-- User 'Log-In' area -->
    <div id = "loginArea">
        <form id="loginForm">
            <label>Enter your nickname: </label>
            <input id="nickname" />
            <input type="submit" value="Join"  />
        </form>
    </div>

    <!-- User Message Area -->
    <div id = "chatroomArea">
        <form id="messageForm">
            <label>Send your message bellow: </label>
            <br />
            <textarea style="resize: none;" rows ="2" cols=40 id="message"></textarea>
            <br />
            <input type="submit" value="Send" />
        </form>
        <br /> <br />

        <!-- Chat -->
        <div id="chat"></div>
    </div>


    <script>
        $(function(){
            // Connection
            var socket = io.connect();

            // Login 'screen' variables
            var $loginArea = $('#loginArea');
            var $loginForm = $('#loginForm');
            var $nickname = $('#nickname');

            // Chatroom variables
            var $chatroomArea = $('#chatroomArea');
            var $messageForm = $('#messageForm');
            var $message = $('#message');
            var $chat = $('#chat');

            $chatroomArea.hide();   // Chatroom is not visible before choosing a nickname

            // Send the user's nickname to the server
            $loginForm.submit(function(e){
                // Prevent page from refreshing
                e.preventDefault();

                if ($nickname.val() != ''){
                    // Associate the nickname to the socket
                    socket.nickname = $nickname.val();

                    // Hide the login area and display the chatroom itself
                    $loginArea.hide();
                    $chatroomArea.show();
                }
            });

            // Send the message to Server on 'Send' button click
            $messageForm.submit(function(e){
                // Prevent page from refreshing
                e.preventDefault();

                // Send message to the server
                socket.emit('send message' , {content:$message.val() , nickname:socket.nickname});

                // Clear the text textarea
                $message.val('');
            });

            // When receiving a message from the server, append it to the chat div
            socket.on('new message' , function(data){
                $chat.append('<p>' + data + '</p>');
            });
        });
    </script>


</body>


</html>
